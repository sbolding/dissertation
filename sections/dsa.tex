
\chapter{\uppercase {Accelerated Iterative Solution to the LO Equations}}

As described in Sec.~\ref{sec:lo_sol}, the fully-discrete, S$_2$-like LO equations
are not easy to directly inverted efficiently in higher spatial dimensions.  
To demonstrate a possible path forward in
higher dimensions, we have investigated the use of a standard
source iteration scheme to invert the scattering terms in the LO equations.  As
material properties become more diffusive (e.g., $c_v$ is small and $\sigma_a$ is
large), the effective scattering cross sections becomes large.  This results in a spectral radius of the source iterations that approaches
unity~\cite{morel_ldtrt}.  These regimes are typical in TRT simulations, so an
acceleration method for an iterative solution is critical. 
We have accelerated the source iterations with a nearly-consistent diffusion synthetic acceleration
(DSA) method known as WLA~\cite{wla,wla_thesis}.

REWRITE: STUFF ABOUT LUMPING ETC.
We have also recast the DSA method as a preconditioner to an iterative
Krylov solution~\cite{larson_morel_sn} of the LO equations.  Generally, Krylov
methods mitigate acceleration losses due to inconsistencies in the acceleration
method.  In higher dimensions, the use of a Krylov method is necessary for effective
acceleration for nearly-consistent acceleration methods in problems with
mixed optical thicknesses~\cite{larson_morel_sn}, e.g., typical radiative transfer
problems.  Also, applying the preconditioned-Krylov approach allows for the use of
spatially lumped DSA  equations as a preconditioner, with the LO equations using
alternative fix-up methods.  We expect better acceleration performance (DID WE GET IT?) when the
LDD discretization is introduced into the LO equations. 

In the remainder of this chapter is structured as follows:  The source
iteration solution to the LO equations is detailed.  Then, the equations for the WLA DSA
method are derived and the acceleration algorithm is given.  The DSA method is then recast
as a preconditoner to a GMRES solution to the scattering iteration equations.  Finally,
results are given for a modified test problem which requires the use of acceleration.

\section{Source Iteration Solution to the Linearized LO Equations}
\label{sec:si}

The linearized LO equations can be solved with a source iteration
method~\cite{lewis,morel_dsa,mcclarren_notes}.  In the source iteration
process the scattering source is lagged, which
uncouples unknowns between the two half-ranges.  This produces a lower-triangular
system where the spatial unknowns can be solved for sequentially along the two directions of flow via a
standard sweeping procedure~\cite{lewis,morel_ldtrt}.  Beginning at the left boundary, the
positive unknowns can be determined for each cell from $i=1,\ldots,N_c$; because the
inflow to the $i$-th cell is defined from the previous cell or boundary condition, a local system
of equations can be solved for the $\mom{\phi}_{L,i}^+$ and $\mom{\phi}_{R,i}^+$ unknowns.
The negative direction unknowns are
determined similarly, starting from the
right boundary towards the left.  The newly computed half-range
intensities can then be used to estimate the scattering source for the next iteration.  This
process is repeated until convergence.  

The source iteration process can be written in operator notation as
\begin{equation}
    \B M \psi^{l+1} = \B S\psi^{l} + Q,
\end{equation}
where $M$ is the discretized LO streaming plus removal operator (i.e., scattering is not
included) and $\psi$ is a vector of the half-range, FE moment unknowns.  The vector $Q$
contains the fixed source terms resulting from the linearized emission source and previous
time step moments, for each equation.  The source terms for the $i$-th element and the $L$ equation
are
\begin{equation}
    (\B Q)_{i,L}^\pm = \frac{\mom{\phi}_L^\pm}{c\Delta t} + \frac{1}{2}f_i \sigma_{a,i} a c \mom{
        (T^{n})^4}_{L,i}
\end{equation}
The scattering operator terms for the $i$-th element and the $L$ equations are
\begin{equation}
    (\B S \psi^l)^{\pm}_{i,L} = \frac{1}{2}\left(\sigma_{a,i} (1-f_i) + \sigma_{s,i}\right)
    \left(\mom{ \phi^l}_{i,L}^+ + \mom{ \phi^l}_{i,L}^-\right).
\end{equation}
Equivalent expressions are defined for the $R$ moment equations and boundary conditions,
forming a fully defined set of equations.  The process of sweeping is denoted as $\B
M^{-1}$.

The scattering inversion must be
performed within each Newton iteration.  Thus, for the $m$-th Newton step, the source
iteration process is defined as
\begin{enumerate}
    \item Evaluate effective scattering and absorption cross sections with
        ${\{T^m_i:\;\, i=1,2,\ldots,N_c\}}$.
    \item\label{en:si_beg} Compute new scattering source $\B S \psi^l$.
    \item Perform sweeps to calculate $\psi^{l+1} = \B M^{-1} \B S\psi^{l} + \B M^{-1} Q$
    \item\label{en:si_end} If $\|\psi^{l+1} - \psi^{l} \| < $ tolerance, exit
    \item Else: repeat steps~\ref{en:si_beg}--\ref{en:si_end}.
\end{enumerate}

\section{Linear Diffusion Synthetic Acceleration}

A form of DSA referred to as the WLA method is used to accelerate the source
iterations~\cite{wla,wla_thesis}. 
Between each source iteration, a residual equation is formed that provides 
the error in the current scattering iteration. The DSA method uses an approximate,
lower-order operator to solve the error equation for a correction to the zeroth angular moment of the
intensity, i.e., the mean intensity $\phi(x)$.  The DSA equations contain a standard
finite-difference diffusion discretization that can be more efficiently
inverted than the S$_2$-like equations that are being accelerated, but will accurately resolve the
slowly converging diffusive error modes.  It is important for the spatial discretization of the DSA
equations to be closely related to the discretization of the LO equations for the
acceleration to be effective and stable~\cite{adams_dsa}.  The WLA method first solves a spatially-continuous
discretization of the diffusion equation
for the iterative error on faces.  The error on the faces is then mapped onto the
volumetric moment unknowns via a LD discretization of the P$_1$ equations~\cite{wla}.
The LD mapping resolves issues that would occur in optically-thick cells, while the
continuous diffusion equation is accurate in the EDL where acceleration is important~\cite{adams_dsa}.

In the remainer of this section we derive the discretized diffusion and update equations.  To simplify notation, we
derive the diffusion equations from a generic transport equation with isotropic scattering
and source $q_0$, i.e.,
\begin{equation}\label{eq:ss_trans}
    \mu \pderiv{I}{x} + \sigma_t I = \frac{\sigma_s}{2}\left( \phi(x) + q_0\right)
\end{equation}
The WLA-DSA algorithm is then detailed.

\subsection{Forming a Continuous Diffusion Equation}

First, a continuous spatial discretization of a diffusion equation is derived.  
The mean intensity $\phi$ will ultimately be assumed continuous at faces to produce a
standard three-point finite-difference diffusion discretization. 
The zeroth and first $\mu$ moment of Eq.~\eqref{eq:ss_trans} produce the $P_1$
equations~\cite{lewis,wla_thesis}, i.e., 
\begin{align}\label{eq:dsa_bal}
    \pderiv{J}{x} + \sigma_a \phi &= q_0 \\ \label{eq:p1}
    \sigma_t J + \frac{1}{3} \pderiv{\phi}{x} &= 0, 
\end{align}
where $q_0=\int_{-1}^1 q(x,\mu) \dd \mu $.
The spatial finite element moments (defined by Eq.~\eqref{eq:x_moml} and~\eqref{x_momr})
are taken of the above equations. 
The mean intensity is assumed linear on the interior of the cell, i.e.,
$\phi(x)=\phi_Lb_L(x) + \phi_Rb_R(x)$, for $x\in(\xl,\xr)$.   Taking the left moment,
evaluating integrals, and rearranging yields
\begin{equation}
    J_{i} - J_{\il}  + \frac{\sigma_{a,i}h_i}{2} \left(\frac{2}{3} \phi_{L,i} + \frac{1}{3}
    \phi_{R,i} \right) = \frac{h_i}{2} \mom{q}_{L,i}\,\,,
\end{equation}
where $J_i$ is the average of the flux $J$ over the cell. The moments of $q$ are
not simplified to be compatible with the error equations which are in terms of moments. For the $R$ moment
\begin{equation}
    J_{i+1/2} - J_{i}  + \frac{\sigma_{a,i}h_i}{2} \left(\frac{2}{3} \phi_{L,i} + \frac{1}{3}
    \phi_{R,i} \right) = \frac{h_i}{2} \mom{q}_{R,i}\,\,.
\end{equation}
The equation for the $L$ moment is evaluated for cell $i+1$ and added to the $R$ moment
equation evaluated at $i$.  The flux $J$ is assumed continuous at $\ir$ to eliminate
the face fluxes from the equations.  The sum of the two equations becomes
\begin{multline}\label{eq:diff_noclose}
    J_{i+1} - J_{i} + \frac{\sigma_{a,i+1} h_{i+1}}{2}\left(\frac{2}{3} \phi_{L,i+1} +
    \frac{1}{3}\phi_{R,i+1}\right) + \frac{\sigma_{a,i} h_i}{2} \left( \frac{1}{3} \phi_{L,i} +
    \frac{2}{3}\phi_{R,i}\right) =\\ \frac{h}{2} \left(\mom{q}_{L,i+1} + \mom{q}_{R,i}
    \right).
\end{multline}
The mean intensity is approximated as continuous at each face, i.e., $\phi_{L,i+1} = \phi_{R,i}
\equiv \phi_{i+1/2}$.  Adding the $L$ and $R$ moments of Eq.~\eqref{eq:p1} together, with
the continuous approximation for $\phi_{i+1/2}$, produces a discrete Fick's law equation~\cite{stacy}
\begin{equation}\label{eq:ficks}
    J_{i} = -D_i \frac{\phi_{i+1/2} - \phi_{i-1/2}}{h_i},
\end{equation}
where $D_i = 1/(3\sigma_{t,i})$.
Substitution of Eq.~\eqref{eq:ficks} into Eq.~\eqref{eq:diff_noclose} and rearranging yields the following discrete diffusion
equation:
\begin{multline}
        \left(\frac{\sigma_{a,i+1} h_{i+1}}{6} -
        \frac{D_{i+1}}{h_{i+1}}\right)\phi_{i+3/2} + \left(\frac{D_{i+1}}{h_{i+1}} +
        \frac{D_{i}}{h_i} + \frac{\sigma_{a,i+1} h_{i+1}}{3} + \frac{\sigma_{a,i}
        h_{i}}{3}\right)\phi_{i+1/2} \\ + \left(\frac{\sigma_{a,i} h_{i}}{6} -
        \frac{D_{i}}{h_{i}}\right)\phi_{i-1/2} = \frac{h_{i+1}}{2} \mom{q}_{L,i+1} +
        \frac{h_{i}}{2}\mom{q}_{R,i}\;\,. 
\end{multline}
To allow for the use of lumped
or standard LD in these equations, we introduce the factor $\theta$, with
$\theta=1/3$ for standard
LD, and $\theta=1$ for lumped LD.  The diffusion equation becomes
\begin{multline}\label{eq:dsa_lumped}
    \left(\frac{\sigma_{a,i+1} h_{i+1}}{4}\left(1 - \theta\right)  -
        \frac{D_{i+1}}{h_{i+1}}\right)\phi_{i+3/2} + \left(\frac{D_{i+1}}{h_{i+1}} +
        \frac{D_{i}}{h_i} + \left(\frac{1+\theta}{2} \right)\left[\frac{\sigma_{a,i+1} h_{i+1}}{2} + \frac{\sigma_{a,i}
        h_{i}}{2}\right]\right)\phi_{i+1/2} \\ + \left(\frac{\sigma_{a,i}
        h_{i}}{4}\left(1 - \theta\right) -
        \frac{D_{i}}{h_{i}}\right)\phi_{i-1/2} = \frac{h_{i+1}}{2} \mom{q}_{L,i+1} +
        \frac{h_{i}}{2}\mom{q}_{R,i}
        \;\,. 
\end{multline}
Summation over all cells forms a system of equations for $\phi$ at each face.  

\subsubsection{Diffusion Boundary Conditions}

The upwinding in the LO system exactly satisfies the inflow boundary conditions, therefore
a vacuum boundary condition is applied to the diffusion error equations.  The equation for the left moment
at the first cell is given by
\begin{equation}\label{eq:dsa_bc}
    J_{1} - J_{1/2}  + \frac{\sigma_{a,i}h_i}{2} \left(\frac{1+\theta}{2} \phi_{L,i}
    + \frac{1-\theta}{2}
    \phi_{R,i} \right) = \frac{h_i}{2} \mom{q}_{L,i}\,\,,
\end{equation}
The Marshak boundary condition for the vacuum inflow at face $x_{1/2}$ is given as
\begin{equation}
    J^+_{1/2} = 0 = \frac{\phi_{1/2}}{4} + \frac{J_{1/2}}{2},
\end{equation}
which can be solved for $J_{1/2}$.  Substitution of the above equation and
Eq.~\eqref{eq:ficks} into Eq.~\eqref{eq:dsa_bc} gives 
\begin{equation}\label{eq:bc_dsa}
    \left(\frac{1}{2}+ \sigma_{a,1}h_1\frac{1+\theta}{4} - \frac{D_1}{h_1}\right)\phi_{1/2} +
    \left( {\sigma_{a,1}{h_1}}\frac{1-\theta}{4} - \frac{D_1}{h_1}  \right)\phi_{3/2} =
    \frac{h_i}{2} \mom{q}_{L,1}
\end{equation}
A similar expression can be derived for the right-most cell.

\subsection{Mapping Solution onto LD Unknowns}

Solution of the continuous diffusion equation will provide an approximation to the error
of $\phi$ on faces, denoted as $\phi_{i+1/2}^C$. We now need
to determine the correction these results provide for the LD representation of
$\phi$. To do this, first we take the $L$ and $R$ finite element moments of the P$_1$
equations.  A LDFE dependence is assumed on the interior of the cell for $J$ and
$\phi$.  Taking moments of Eq.~\eqref{eq:dsa_bal} and simplifying yields
\begin{align}
    J_{\ir} - \frac{J_{L,i} + J_{R,i}}{2} + \frac{\sigma_{a,i} h_i}{2} \left(\frac{1}{3} \phi_{L,i} +
    \frac{2}{3}\phi_{R,i}\right) &= \frac{h_i}{2} \mom{q}_{R,i} \\
    \frac{J_{L,i} + J_{R,i}}{2} - J_{i-1/2} + \frac{\sigma_{a,i} h_i}{2}
    \left(\frac{2}{3} \phi_{L,i} +
    \frac{1}{3}\phi_{R,i}\right) &= \frac{h_i}{2} \mom{q}_{L,i}
\end{align}
The moment equations for Eq.~\eqref{eq:p1} are
\begin{align}
    \frac{1}{3}\left(\phi_{\ir} - \frac{\phi_{i,L} + \phi_{i,R}}{2}\right) +
    \frac{\sigma_{t,i} h_i}{2} \left(\frac{1}{3} J_{L,i} + \frac{2}{3}J_{R,i}\right)
    &= 0 \\
    \frac{1}{3}\left(\frac{\phi_{i,L} + \phi_{i,R}}{2} - \phi_{i-1/2} \right) +
    \frac{\sigma_{t,i} h_i}{2} \left(\frac{2}{3} J_{L,i} + \frac{1}{3}J_{R,i}\right)
    &= 0 
\end{align}
The face terms $J_{i\pm 1/2}$ and $\phi_{i\pm 1/2}$ need to be eliminated from the
system. The scalar intensity is assumed to be the value provided by the continuous
diffusion solution at each face, i.e., $\phi_{i\pm1/2} = \phi_{i\pm1/2}^C$.
The fluxes are decomposed into half-range values to decouple the equations
between cells.  At $x_{\ir}$, the current is composed as $J_{i+1/2} = J_{\ir}^+ - J_{\ir}^-$,
where $+$ and $-$ denote the positive and negative
half ranges of $\mu$, respectively.  We approximate the incoming fluxes, e.g.,
$J_{i+1/2}^-$, based on $\phi_{i+1/2}^C$.  
The P$_1$ approximation provides the following relation~\cite{wla_thesis}
\begin{equation}
    \phi = 2(J^+ + J^-).
\end{equation}
At $\xr$, the above expression is solved for the incoming current $J_{i+1/2}^-$.  The
total current becomes, with $\phi_{i+1/2}=\phi_{i+1/2}^C$,
\begin{equation}\label{eq:jelim}
    J_{\ir} = J_{\ir}^+ - J_{\ir}^- = 2J_{\ir}^+ - \frac{\phi_{i+1/2}^C}{2},
\end{equation}
In the positive direction, at the right face, the
values of $\phi$ and $J$ are based on the LD representation within the cell at that
face, i.e., $\phi_{R,i}$ and $J_{R,i}$.  The standard P$_1$ approximation for the
half-range fluxes is used\cite{stacy}, i.e.,
\begin{align}
    J^{\pm} &= \frac{\gamma \phi}{2} \pm \frac{J}{2},
\end{align}
where $\gamma$ accounts for the difference between the LO parameters and the true
P$_1$ approximation. Thus, for the right face and positive half-range,
\begin{align}
    J_{\ir}^+ &= \frac{\gamma}{2}\phi_{i,R} + \frac{J_{i,R}}{2} 
\end{align}
A similar expression can be derived for $\xl$.  The total fluxes at each face are
thus
\begin{align}
    J_{i+1/2} &= \gamma\phi_{i,R} + J_{i,R} - \frac{\phi_{\ir}^C}{2} \\
    J_{i-1/2} &= \frac{\phi_{i-1/2}^C}{2} - \gamma \phi_{i,L} + J_{i,L}
\end{align}
Substitution of these results back into the LD balance equations and introduction of the
lumping notation yields the final equations 
\begin{align}\label{eq:update1}
    \left(\gamma\phi_{i,R} + J_{i,R} - \frac{\phi_{\ir}^C}{2} \right) - \frac{J_{L,i} + J_{R,i}}{2} + \frac{\sigma_{a,i} h_i}{2} \left(
    \frac{(1-\theta)}{2} \phi_{L,i} +
    \frac{(1+\theta)}{2}\phi_{R,i}\right) &= \frac{h_i}{2} \mom{q}_{R,i} \\
    \frac{J_{L,i} + J_{R,i}}{2} -\left(\frac{\phi_{i-1/2}^C}{2} - \gamma \phi_{i,L} +
    J_{i,L}\right) + \frac{\sigma_{a,i} h_i}{2} \left(
    \frac{(1+\theta)}{2} \phi_{L,i} +
    \frac{(1-\theta)}{2}\phi_{R,i}\right) &= \frac{h_i}{2} \mom{q}_{L,i} 
    \\
    \frac{1}{3}\left(\phi_{i+1/2}^C - \frac{\phi_{i,L} + \phi_{i,R}}{2}\right) +
    \frac{\sigma_{t,i} h_i}{2}\left( \frac{(1-\theta)}{2} J_{L,i} +
    \frac{(1+\theta)}{2}J_{R,i}\right)    &= 0 \\
    \frac{1}{3}\left(\frac{\phi_{i,L} + \phi_{i,R}}{2} - \phi^C_{i-1/2} \right) +
    \frac{\sigma_{t,i} h_i}{2} \left( \frac{(1+\theta)}{2} J_{L,i} +
    \frac{(1-\theta)}{2}J_{R,i}\right) &= 0 . \label{eq:update2}
\end{align}
The above equations are completely local to each cell and fully defined, including for
boundary cells.  The system can be solved for the desired unknowns
$\phi_{i,L}$, $\phi_{i,R}$, $J_{i,L}$, and $J_{i,R}$, which represent the mapping of
$\phi_{i+1/2}^C$ onto the LD representation for $\phi(x)$.


\subsection{DSA Source Definition}

The above discretization procedure is used to determine the error in the scalar intensity.
The sources $\mom{q}_{L/R}$ for the error equations remain to be defined.  In operator
notation, the following
iteration equations can be defined
\begin{align}
    \B L \psi^{l+1/2} &= \B S \psi^{l+1} + Q \\
    \B D \delta \phi^{l+1/2} &= \sigma_s (\phi^{l+1/2} - \phi^{l}) \label{eq:dsa_oper} \\
     \psi^{l+1/2} &= \B \psi^{l+1/2} + \delta \B \phi^{l+1/2}
\end{align}
It is noted that unlike fully consistent DSA equations, the WLA-DSA algorithm does not
preserve particle balance to round off.  This is because the mapping procedure uses an
approximate inflow to each cell, which is inconsistent with the partial outflows from
adjacent cells.

The source in Eq.~\eqref{eq:dsa_oper}, i.e., $q$ in
Eqs.~\eqref{eq:dsa_lumped}~and~\eqref{eq:bc_dsa}, is the residual for a given scattering iteration,
given by~\cite{morel_dsa,lewis}
\begin{equation}
    q = \sigma_s\left(\phi^{l+1/2} - \phi^{l}\right).
\end{equation}
The spatial moments are straight forward:
\begin{equation}\label{eq:dsa_src}
    \mom{q}_{L,i} = \sigma_{s,i}\left(\mom{\phi^{l+1/2}}_{L,i} -
    \mom{\phi^{l}}_{L,i}\right)
\end{equation}
The above equation is valid for lumping or standard LD.  This is because the LO
moments are defined differently for LLD or LD, resulting in equations that are
consistent.  For instance, for lumped LD, we desire the right equation to have $\mom{q}_{R,i} =
\sigma_s(\phi^{l+1/2}_{R,i} - \phi^{l}_{R,i})$.   The lumped LO system uses a spatial closure and
linear relation where the edge values are defined as the moments, e.g.,
$\mom{\phi}^+_{R,i} \equiv \phi^+_{R,i}$.
Substituting the closure into the right side of Eq.~\eqref{eq:dsa_src} gives the desired
source $\mom{q}_{R,i} = \sigma_{s,i}\left({\phi^{l+1/2}}_{R,i} -
    \phi^{l}_{R,i}\right) $. 

Solution of the diffusion equation provides a correction to $\phi$ for the volumetric FE
unknowns. Because we are interested in the time-dependent solution, we need to accelerate the solution for the
half-range intensities, rather than just the zeroth moment. We only accelerate the zeroth
moment of the angular intensity, as the solution for $J$ is inaccurate due to the
approximations introduced.  Thus, the error in the mean intensities is updated as, using
the lumping notation,
\begin{align}
    \mom{\delta \phi^{\pm}}_L =&  \frac{1+\theta}{4}\delta \phi^{\pm}_{L} +
    \frac{1-\theta}{4}\delta \phi^{\pm}_{R}  \\
    \mom{\delta \phi^{\pm}}_R =&  \frac{1-\theta}{4}\delta \phi^{\pm}_{L} +
    \frac{1+\theta}{4}\delta \phi^{\pm}_{R}      ,
\end{align}

\subsection{The WLA-DSA Accelerated Source Iteration Algorithm}

We define the process of solving the diffusion like equations and mapping the error
unknowns back onto the moment equations as the operator $\B D^{-1}$.
The source iteration with linear DSA procedure, for the $m$-th Newton iteration, is then defined as
\begin{enumerate}
    \item Evaluate effective scattering and absorption cross sections with
        ${\{T^m_i:\;\, i=1,2,\ldots,N_c\}}$.
    \item\label{en:dsa_beg} Compute new scattering source $\B S \psi^l$.
    \item Perform sweeps to calculate $\psi^{l+1/2} = \B M^{-1} \B S\psi^{l} + \B M^{-1} Q$
    \item Perform DSA iteration to solve $\phi^{l+1} = \B D^{-1} \sigma_s(\phi^{l+1/2}-\phi^l)$
        \begin{itemize}
    \item Solve continuous DSA equations, i.e., Eq.~\eqref{eq:dsa_lumped} and
        Eq.~\eqref{eq:dsa_bc}, for \\${\{\delta
            \phi^{l+1/2}_{i+1/2}:\;i=0,1,\ldots,N_c\}}$.
        \item Map the continuous error onto the moment unknowns, via
            Eq.~\eqref{eq:update1}--\eqref{eq:update2}.
    \end{itemize}
    \item Add correction to the moment unknowns, e.g., $\phi_L^{\pm,l+1} = \phi_L^{\pm,l+1/2} +
        \delta \phi^{l+1/2}/2$.
    \item\label{en:dsa_end} If $\|\psi^{l+1} - \psi^{l} \| < $ tolerance, exit
    \item Else: repeat steps~\ref{en:dsa_beg}--\ref{en:dsa_end}.
\end{enumerate}

\section{GMRES Solution to the LO Equations}

The source iteration procedure can be recast as an iterative solution to a matrix
equation. Using operator notation, we manipulate
the moment equations to form a matrix equation:
\begin{equation}
    \left(\B I  - \B M^{-1}\B S\right) \psi = \B M^{-1} Q,
\end{equation}
where $I$ is an identity matrix.  The GMRES method is used to iteratively solve the above
linear system. The GMRES is an iterative Krylov solution method for asymmetric, sparse matrix
equations~\cite{saad}.   Krylov solutions to a linear system repeatedly apply the
matrix operator to vectors, projecting the system onto a Krylov
subspace~\cite{saad}.  Rather than forming the full matrix system, we apply the
operation of $\B S$ and $\B M^{-1}$ as detailed in Sec.~\eqref{sec:si} to apply $\left(\B I  - \B M^{-1}\B S\right)$ to the Krylov vectors. 

The GMRES method will generally converge faster than the source iteration
procedure~\cite{morel_dsa}.  However, as the system becomes scattering dominated,
convergence will degrade.  To improve the convergence rate, we precondition the GMRES
system with the WLA-DSA method.  The goal of preconditioning is to efficiently apply an
operator to the equation that will approximate the inverse of the matrix operator. Left
preconditioning~\cite{saad} was applied to the above system.  In matrix form, we write the preconditioned GMRES equations as
\begin{equation}
    \left(\B I + \B D^{-1} \B S\right)\left(\B I - \B L^{-1} \B S \right) \psi = \left( \B I + \B
    D^{-1}\B S\right) \B L^{-1} Q.
\end{equation}
The operation of $\left(\B I + \B D^{-1} \B S\right)^{-1}$ is equivalent to the DSA
procedure, adding the correction to a Krylov vector.

The opensource library \verb{mgmres{ was modified to implement the matrix-free version of
    the GMRES procedure. The
    infrastructure from the source iteration with DSA procedure is reused to provide
    the operation of $\left(\B I + \B D^{-1} \B S \right)\left(\B I  - \B M^{-1}\B
    S\right)$ applied to the Krylov vectors returned from the GMRES solver.
 The preconditioned-GMRES algorithm is
\begin{enumerate}
    \item Evaluate effective scattering and absorption cross sections with
        ${\{T^m_i:\;\, i=1,2,\ldots,N_c\}}$.
    \item Form initial source vector $b$ by solving $b = \B M^{-1} Q$
    \item Apply left-preconditioner operator to $b$, so $b \leftarrow \left( \B I + \B
        D^{-1}\B S\right) \B M^{-1} Q$
    \item\label{en:dsa_beg} Compute new scattering source $\B S \psi^l$.
    \item Perform sweeps to calculate $\psi^{l+1/2} = \B M^{-1} \B S\psi^{l} + \B M^{-1} Q$
    \item Compute DSA residual source $\sigma_s(\phi^{l+1/2}-\phi^l)$
    \item Solve continuous DSA equations (i.e., Eq.~\eqref{eq:dsa_lumped}) for ${\{\delta \phi^{l+1/2}_{i+1/2}:\;i=0,1,\ldots,N_c\}}$
    \item Map the continuous error onto the moment unknowns.
    \item\label{en:dsa_end} If $\|\psi^{l+1} - \psi^{l} \| < $ tolerance, exit
    \item Else: repeat steps~\ref{en:dsa_beg}--\ref{en:dsa_end}.
\end{enumerate}
The convergence tolerance is based on the residual$.
Without preconditioning, the diffusion solve is simply removed.


\section{Computational Results}

It is noted we are not interested in measuring the reduction of
computational time in this section because in 1D the LO equations can be directly solved efficiently.
We are just interested in ensuring that the acceleration methods can reduce the
number of scattering iterations sufficiently, including cases where inconsistencies
in the LO equations are present.

We test our acceleration methods with three test problems.  The first is the two material
problem in Sec~\ref{sec:two_mat}.  The second problem is a modification of the two material problem described in
Sec.~\ref{sec:two_mat}. The problem specifications are the same as before, except for
modifications to the material properties for $x>0.5$ cm.  In the right region, the
parameters are $\sigma_a = 20,000$ cm$^{-1}$, $\sigma_s=500 $ cm$^{-1}$ $c_v =??? $ Jk
g$^{-1}$ keV$^{-1}$.  The third test problem is the diffusion limit problem described in
Sec.~\ref{sec:diff_limit}.

\subsection{Results for LD Spatial Discretization}

We first test this problem with the source iteration using DSA to accelerate and compare
to an unaccelerated SI solution.  3 batches of 10,000 particles are ran for each HO
solve, one HO solver per time step.  We tally the total number of source iterations per
time step, over the two solves.  We initialize the solution for the scattering iterations to zero at the beginning of
each LO solve.  We reduce the solve time for each to 1.0 sh.  The time step begins at
0.001 sh and linearly increases by 15 \% each time step to a maximum time step size of
0.01 sh.  The larger time step size increases the amount of diffusive behavior.  The
scattering iterations have a relative convergence between scattering iterations of 1.E-10.

For the DSA we have used a lumped spatial representation in all cases.  This should cause
some inconsistency issues.


\begin{table}
    \caption{\label{tab:twomat_dsa_iters} Scattering source iterations for the two
material problem.  Simulation end time is 1 sh.}
    \begin{tabular}{ccc} \hline
        Method & Sweeps/Newton Step & Newton Steps/LO Solve \\ \hline
        SI     & 247.0 & 19.4                \\
        SI-DSA & 10.1   & 19.3      \\
        GMRES  & 13.1    &  19.4     \\
        GMRES-DSA & 7.7  &  19.3  \\ \hline
    \end{tabular}
\end{table}



\begin{table}
    \caption{\label{tab:twomat_dsa_iters} Scattering source iterations for the equilibrium
    diffusion limit problem.  Simulation end time is 3 sh.}
    \begin{tabular}{ccc} \hline
        Method    &  Sweeps/Newton Step & Newton Steps/LO Solve \\ \hline
        SI        & 357.4  &  4.2                  \\
        SI-DSA    & 21.9   &  4.2     \\
        GMRES     & 36.5   &  4.2    \\
        GMRES-DSA & 13.3   &  4.2   \\ \hline 
         \multicolumn{3}{|c|}{Lumped LO Equations} \\ \hline
        SI        & 359.8         & 4.1      \\ 
        SI-DSA    & 14.6          & 4.1     \\ 
        GMRES     & 37.3          &  4.1   \\
        GMRES-DSA & 9.8           &  4.1   \\ \hline 
    \end{tabular}
\end{table}




